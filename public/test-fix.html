<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•ä¿®å¤ - é€‰ä¸­æ–‡æœ¬æ ‡è®°æ¡†å’Œå¿«é€Ÿæ ‡æ³¨</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .test-info {
            background: #f0f9ff;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px;
        }
        .test-info h2 {
            color: #1e40af;
            margin-top: 0;
        }
        .test-steps {
            background: white;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }
        .test-steps ol {
            margin: 0;
            padding-left: 20px;
        }
        .test-steps li {
            margin: 10px 0;
            line-height: 1.6;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            margin-left: 10px;
        }
        .status.fixed {
            background: #10b981;
            color: white;
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="test-info">
            <h2>ğŸ”§ ä¿®å¤éªŒè¯æµ‹è¯•é¡µé¢</h2>
            <p><strong>ä¿®å¤å†…å®¹ï¼š</strong></p>
            <ul>
                <li>âœ… ä¿®å¤é€‰ä¸­æ–‡æœ¬æ²¡æœ‰å¼¹å‡ºæ ‡è®°æ¡†çš„é—®é¢˜ <span class="status fixed">å·²ä¿®å¤</span></li>
                <li>âœ… ä¿®å¤å¿«é€Ÿæ ‡æ³¨æ¨¡å¼æ— æ³•å¿«é€Ÿæ ‡æ³¨çš„é—®é¢˜ <span class="status fixed">å·²ä¿®å¤</span></li>
            </ul>

            <div class="test-steps">
                <h3>ğŸ“‹ æµ‹è¯•æ­¥éª¤ï¼š</h3>
                <ol>
                    <li><strong>æµ‹è¯•é€‰ä¸­æ–‡æœ¬å¼¹å‡ºæ ‡è®°æ¡†ï¼š</strong>
                        <ul>
                            <li>åœ¨ä¸‹æ–¹é˜…è¯»åŒºé€‰ä¸­ä»»æ„æ–‡æœ¬</li>
                            <li>åº”è¯¥ä¼šå¼¹å‡ºæ ‡æ³¨å·¥å…·æ </li>
                            <li>å¯ä»¥é€‰æ‹©ç±»åˆ«ã€é¢œè‰²ç­‰è¿›è¡Œæ ‡æ³¨</li>
                        </ul>
                    </li>
                    <li><strong>æµ‹è¯•å¿«é€Ÿæ ‡æ³¨æ¨¡å¼ï¼š</strong>
                        <ul>
                            <li>ç‚¹å‡»"å¿«é€Ÿæ ‡æ³¨"æŒ‰é’®ï¼ˆæˆ–æŒ‰ Ctrl+Qï¼‰è¿›å…¥å¿«é€Ÿæ ‡æ³¨æ¨¡å¼</li>
                            <li>å…ˆåœ¨å·¥å…·æ é€‰æ‹©è¦ä½¿ç”¨çš„é¢œè‰²å’Œæ ·å¼</li>
                            <li>ç„¶åé€‰ä¸­æ–‡æœ¬ï¼Œåº”è¯¥ç«‹å³åº”ç”¨æ ‡æ³¨ï¼Œæ— éœ€å¼¹å‡ºå¯¹è¯æ¡†</li>
                            <li>å†æ¬¡ç‚¹å‡»"é€€å‡ºå¿«é€Ÿæ ‡æ³¨"ï¼ˆæˆ–æŒ‰ Escï¼‰é€€å‡ºæ¨¡å¼</li>
                        </ul>
                    </li>
                </ol>
            </div>

            <div style="margin-top: 15px; padding: 10px; background: #fef3c7; border-radius: 6px;">
                <strong>ğŸ’¡ æç¤ºï¼š</strong>
                <ul style="margin: 5px 0;">
                    <li>ä¿®å¤äº†é‡å¤çš„ mouseup äº‹ä»¶ç›‘å¬å™¨å†²çª</li>
                    <li>ä¿®å¤äº† applyHighlight å‡½æ•°è°ƒç”¨ç¼ºå°‘ range å‚æ•°çš„ bug</li>
                    <li>å¢å¼ºäº†é”™è¯¯æç¤ºï¼Œæä¾›æ›´å‹å¥½çš„ç”¨æˆ·ä½“éªŒ</li>
                </ul>
            </div>
        </div>

        <header class="app-header">
            <h1>è‹±è¯­çŸ­æ–‡é˜…è¯»æ ‡æ³¨å·¥å…· - æµ‹è¯•é¡µé¢</h1>
        </header>

        <main class="layout" style="display: block;">
            <section class="panel reader-panel">
                <header class="panel-header">
                    <h2>é˜…è¯»æ ‡æ³¨åŒº</h2>
                    <div class="reader-tools">
                        <button id="loadTestTextBtn" type="button">åŠ è½½æµ‹è¯•æ–‡æœ¬</button>
                        <button id="clearHighlightsBtn" class="ghost-btn" type="button">æ¸…é™¤å…¨éƒ¨æ ‡æ³¨</button>
                    </div>
                </header>

                <div class="formatting-toolbar" role="toolbar" aria-label="å¿«é€Ÿæ ‡æ³¨å·¥å…·">
                    <div class="format-group" aria-label="æ–‡æœ¬æ ·å¼">
                        <button type="button" id="formatBoldToggle" class="format-btn" data-format="bold" aria-pressed="false" title="åŠ ç²— (Ctrl+B)">B</button>
                        <button type="button" id="formatUnderlineToggle" class="format-btn" data-format="underline" aria-pressed="false" title="ä¸‹åˆ’çº¿ (Ctrl+U)">U</button>
                    </div>
                    <div class="format-group color-group" aria-label="èƒŒæ™¯é¢œè‰²">
                        <button type="button" class="format-color" data-color="honey" title="èœœç³–è‰²"></button>
                        <button type="button" class="format-color" data-color="mint" title="è–„è·è‰²"></button>
                        <button type="button" class="format-color" data-color="sky" title="å¤©ç©ºè‰²"></button>
                        <button type="button" class="format-color" data-color="orchid" title="å…°èŠ±è‰²"></button>
                        <button type="button" class="format-color" data-color="sunset" title="è½æ—¥è‰²"></button>
                    </div>
                    <button type="button" id="formatApplyBtn" class="ghost-btn format-apply">å¿«é€Ÿæ ‡æ³¨</button>
                </div>

                <div id="readingArea" class="reading-area" tabindex="0">
                    <p>ç‚¹å‡»"åŠ è½½æµ‹è¯•æ–‡æœ¬"æŒ‰é’®å¼€å§‹æµ‹è¯•ã€‚</p>
                </div>
            </section>
        </main>
    </div>

    <div id="selectionToolbar" class="selection-toolbar hidden" role="dialog" aria-modal="true">
        <form id="annotationForm">
            <fieldset>
                <legend>æ ‡æ³¨ç±»å‹</legend>
                <div class="category-buttons">
                    <button type="button" data-category="vocab">ç”Ÿè¯</button>
                    <button type="button" data-category="phrase">è¯ç»„</button>
                    <button type="button" data-category="difficulty">ç–‘éš¾</button>
                    <button type="button" data-category="keypoint">é‡ç‚¹</button>
                </div>
            </fieldset>

            <fieldset>
                <legend>æ ·å¼</legend>
                <div class="style-options">
                    <div class="color-palette" role="group">
                        <button type="button" data-color="honey" title="èœœç³–è‰²"></button>
                        <button type="button" data-color="mint" title="è–„è·è‰²"></button>
                        <button type="button" data-color="sky" title="å¤©ç©ºè‰²"></button>
                        <button type="button" data-color="orchid" title="å…°èŠ±è‰²"></button>
                        <button type="button" data-color="sunset" title="è½æ—¥è‰²"></button>
                    </div>
                    <div class="style-toggles" role="group">
                        <label class="style-toggle">
                            <input type="checkbox" id="boldToggle"> åŠ ç²—
                        </label>
                        <label class="style-toggle">
                            <input type="checkbox" id="underlineToggle"> ä¸‹åˆ’çº¿æ ·å¼
                        </label>
                    </div>
                </div>
            </fieldset>

            <fieldset>
                <legend>å¤‡æ³¨</legend>
                <div class="field">
                    <textarea id="noteInput" rows="2" placeholder="æ·»åŠ é‡Šä¹‰æˆ–æ³¨é‡Š"></textarea>
                </div>
                <div class="field">
                    <input id="tagsInput" type="text" placeholder="æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰">
                </div>
            </fieldset>

            <div class="toolbar-actions">
                <button type="button" id="cancelAnnotationBtn" class="ghost-btn">å–æ¶ˆ</button>
                <button type="submit" class="primary">ä¿å­˜æ ‡æ³¨</button>
            </div>
        </form>
    </div>

    <script src="script.js"></script>
    <script>
        // æµ‹è¯•è¾…åŠ©è„šæœ¬
        document.addEventListener('DOMContentLoaded', function() {
            const loadTestTextBtn = document.getElementById('loadTestTextBtn');
            if (loadTestTextBtn) {
                loadTestTextBtn.addEventListener('click', function() {
                    const testText = `
                        <h3>Test Document</h3>
                        <p>The quick brown fox jumps over the lazy dog. This sentence contains every letter of the English alphabet.</p>
                        <p>Select any text in this area to test the annotation toolbar. The toolbar should appear immediately after selection.</p>
                        <p>To test quick annotation mode, click the "å¿«é€Ÿæ ‡æ³¨" button, select a color and style, then select text. The annotation should be applied instantly without showing the dialog.</p>
                        <p>In an era defined by relentless information flows, the ability to read analytically has become a critical survival skill.</p>
                    `;

                    const readingArea = document.getElementById('readingArea');
                    if (readingArea) {
                        readingArea.innerHTML = testText;

                        // åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ–‡æ¡£
                        if (typeof state !== 'undefined') {
                            const testDoc = {
                                id: 'test-doc-' + Date.now(),
                                title: 'Test Document',
                                content: testText,
                                annotations: [],
                                createdAt: new Date().toISOString(),
                                updatedAt: new Date().toISOString()
                            };
                            state.documents.push(testDoc);
                            state.activeDocumentId = testDoc.id;

                            if (typeof showToast === 'function') {
                                showToast('âœ“ æµ‹è¯•æ–‡æœ¬å·²åŠ è½½', 'success');
                            } else {
                                alert('âœ“ æµ‹è¯•æ–‡æœ¬å·²åŠ è½½\nç°åœ¨å¯ä»¥å¼€å§‹æµ‹è¯•äº†ï¼');
                            }
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>
