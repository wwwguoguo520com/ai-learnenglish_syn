# é˜…è¯»æ ‡æ³¨å·¥å…· - å·¥å…·æ åŠŸèƒ½å®Œæ•´æ–‡æ¡£

## ç›®å½•

1. [åŠŸèƒ½æ¦‚è§ˆ](#åŠŸèƒ½æ¦‚è§ˆ)
2. [æ–‡æœ¬æ ·å¼æ ¼å¼åŒ–](#æ–‡æœ¬æ ·å¼æ ¼å¼åŒ–)
3. [è¾¹æ¡†æ ·å¼ç³»ç»Ÿ](#è¾¹æ¡†æ ·å¼ç³»ç»Ÿ)
4. [é¢œè‰²ç³»ç»Ÿ](#é¢œè‰²ç³»ç»Ÿ)
5. [ç±»åˆ«ç®¡ç†ç³»ç»Ÿ](#ç±»åˆ«ç®¡ç†ç³»ç»Ÿ)
6. [æ‚¬åœèœå•ç³»ç»Ÿ](#æ‚¬åœèœå•ç³»ç»Ÿ)
7. [ç¬”è®°ç¼–è¾‘å™¨](#ç¬”è®°ç¼–è¾‘å™¨)
8. [çŠ¶æ€ç®¡ç†ä¸æŒä¹…åŒ–](#çŠ¶æ€ç®¡ç†ä¸æŒä¹…åŒ–)
9. [äº¤äº’åé¦ˆç³»ç»Ÿ](#äº¤äº’åé¦ˆç³»ç»Ÿ)
10. [ä½¿ç”¨æµç¨‹](#ä½¿ç”¨æµç¨‹)
11. [æŠ€æœ¯å®ç°ç»†èŠ‚](#æŠ€æœ¯å®ç°ç»†èŠ‚)

---

## åŠŸèƒ½æ¦‚è§ˆ

æœ¬å·¥å…·æ˜¯ä¸€ä¸ªå¼ºå¤§çš„è‹±è¯­é˜…è¯»æ ‡æ³¨ç³»ç»Ÿï¼Œæ”¯æŒæ–‡æœ¬é«˜äº®ã€æ ·å¼è‡ªå®šä¹‰ã€åˆ†ç±»ç®¡ç†ã€ç¬”è®°æ·»åŠ ç­‰åŠŸèƒ½ã€‚æ‰€æœ‰è®¾ç½®è‡ªåŠ¨ä¿å­˜ï¼Œæ”¯æŒå¤šå±‚åµŒå¥—æ ‡æ³¨ã€‚

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- 6ç§åŸºç¡€æ–‡æœ¬æ ·å¼ï¼ˆç²—ä½“ã€ä¸‹åˆ’çº¿ã€è™šçº¿ä¸‹åˆ’çº¿ã€æ–œæ ã€æ–‡æœ¬é¢œè‰²ã€è¾¹æ¡†ï¼‰
- 21ç§é¢„è®¾é¢œè‰²ï¼ˆ7ç§åŸºç¡€è‰² Ã— 3ç§è‰²è°ƒï¼‰
- è‡ªå®šä¹‰ç±»åˆ«ç®¡ç†ï¼ˆæ”¯æŒæ— æ ·å¼çº¯åˆ†ç±»æ¨¡å¼ï¼‰
- æ™ºèƒ½è¾¹æ¡†å°ºå¯¸ï¼ˆåŸºäºæ–‡æœ¬é•¿åº¦å’ŒåµŒå¥—å±‚çº§ï¼‰
- æ‚¬åœå¿«æ·èœå•ï¼ˆå¤åˆ¶ã€ç¼–è¾‘ã€åˆ é™¤ï¼‰
- ä¼˜é›…çš„ Toast é€šçŸ¥ç³»ç»Ÿ

---

## æ–‡æœ¬æ ·å¼æ ¼å¼åŒ–

### 1. ç²—ä½“æ ·å¼ (B)

**åŠŸèƒ½æè¿°ï¼š**
- ä¸ºé€‰ä¸­æ–‡æœ¬æ·»åŠ ç²—ä½“æ•ˆæœ
- æ”¯æŒè‡ªå®šä¹‰ç²—ä½“é¢œè‰²

**ä½¿ç”¨æ–¹æ³•ï¼š**
1. ç‚¹å‡» **B** æŒ‰é’®åˆ‡æ¢ç²—ä½“çŠ¶æ€
2. ç‚¹å‡» **B** æ—çš„ ğŸ¨ æŒ‰é’®é€‰æ‹©ç²—ä½“é¢œè‰²
3. é€‰ä¸­æ–‡æœ¬ååº”ç”¨æ ¼å¼

**ä»£ç ä½ç½®ï¼š**
- `script.js:7115-7123` - ç²—ä½“åˆ‡æ¢é€»è¾‘
- `script.js:2692-2694` - åº”ç”¨ç²—ä½“æ ·å¼
- `styles.css:2467-2474` - ç²—ä½“ CSS æ ·å¼

**çŠ¶æ€å˜é‡ï¼š**
```javascript
state.lastBold: boolean          // ç²—ä½“å¼€å…³çŠ¶æ€
state.lastBoldColor: string      // ç²—ä½“é¢œè‰² (å¦‚ '#ef4444')
```

---

### 2. ä¸‹åˆ’çº¿æ ·å¼ (U)

**åŠŸèƒ½æè¿°ï¼š**
- ä¸ºé€‰ä¸­æ–‡æœ¬æ·»åŠ ä¸‹åˆ’çº¿
- æ”¯æŒè‡ªå®šä¹‰ä¸‹åˆ’çº¿é¢œè‰²

**ä½¿ç”¨æ–¹æ³•ï¼š**
1. ç‚¹å‡» **U** æŒ‰é’®åˆ‡æ¢ä¸‹åˆ’çº¿çŠ¶æ€
2. ç‚¹å‡» **U** æ—çš„ ğŸ¨ æŒ‰é’®é€‰æ‹©ä¸‹åˆ’çº¿é¢œè‰²
3. é€‰ä¸­æ–‡æœ¬ååº”ç”¨æ ¼å¼

**ä»£ç ä½ç½®ï¼š**
- `script.js:7125-7133` - ä¸‹åˆ’çº¿åˆ‡æ¢é€»è¾‘
- `script.js:2696-2698` - åº”ç”¨ä¸‹åˆ’çº¿æ ·å¼
- `styles.css:2477-2485` - ä¸‹åˆ’çº¿ CSS æ ·å¼

**çŠ¶æ€å˜é‡ï¼š**
```javascript
state.lastUnderline: boolean     // ä¸‹åˆ’çº¿å¼€å…³çŠ¶æ€
state.lastUnderlineColor: string // ä¸‹åˆ’çº¿é¢œè‰²
```

---

### 3. è™šçº¿ä¸‹åˆ’çº¿ (- -)

**åŠŸèƒ½æè¿°ï¼š**
- æ·»åŠ è™šçº¿æ ·å¼çš„ä¸‹åˆ’çº¿
- 2px ç²—ç»†ï¼Œ3px ä¸‹åç§»

**ä½¿ç”¨æ–¹æ³•ï¼š**
1. ç‚¹å‡» **- -** æŒ‰é’®åˆ‡æ¢è™šçº¿ä¸‹åˆ’çº¿çŠ¶æ€
2. é€‰ä¸­æ–‡æœ¬ååº”ç”¨æ ¼å¼

**ä»£ç ä½ç½®ï¼š**
- `script.js:7135-7144` - è™šçº¿ä¸‹åˆ’çº¿åˆ‡æ¢é€»è¾‘
- `script.js:2700-2702` - åº”ç”¨è™šçº¿æ ·å¼
- `styles.css:3215-3219` - è™šçº¿ CSS æ ·å¼

**CSS å®ç°ï¼š**
```css
.highlight[data-dashed="true"] {
    text-decoration: underline dashed;
    text-decoration-thickness: 2px;
    text-underline-offset: 3px;
}
```

**çŠ¶æ€å˜é‡ï¼š**
```javascript
state.lastDashed: boolean        // è™šçº¿ä¸‹åˆ’çº¿å¼€å…³çŠ¶æ€
```

---

### 4. æ–œæ åˆ†éš”ç¬¦ (/ /)

**åŠŸèƒ½æè¿°ï¼š**
- åœ¨æ ‡æ³¨æ–‡æœ¬åæ·»åŠ  " / " åˆ†éš”ç¬¦
- åˆ†éš”ç¬¦é¢œè‰²ä¸ºç°è‰² (#999)

**ä½¿ç”¨æ–¹æ³•ï¼š**
1. ç‚¹å‡» **/ /** æŒ‰é’®åˆ‡æ¢æ–œæ çŠ¶æ€
2. é€‰ä¸­æ–‡æœ¬ååº”ç”¨æ ¼å¼

**ä»£ç ä½ç½®ï¼š**
- `script.js:7146-7155` - æ–œæ åˆ‡æ¢é€»è¾‘
- `script.js:2704-2706` - åº”ç”¨æ–œæ æ ·å¼
- `styles.css:3222-3227` - æ–œæ  CSS æ ·å¼

**CSS å®ç°ï¼š**
```css
.highlight[data-slash="true"]::after {
    content: ' / ';
    color: #999;
    margin: 0 2px;
}
```

**çŠ¶æ€å˜é‡ï¼š**
```javascript
state.lastSlash: boolean         // æ–œæ åˆ†éš”ç¬¦å¼€å…³çŠ¶æ€
```

---

### 5. æ–‡æœ¬é¢œè‰² (ğŸ¨)

**åŠŸèƒ½æè¿°ï¼š**
- ä¿®æ”¹æ ‡æ³¨æ–‡æœ¬çš„é¢œè‰²
- ä»21ç§é¢„è®¾é¢œè‰²ä¸­é€‰æ‹©

**ä½¿ç”¨æ–¹æ³•ï¼š**
1. ç‚¹å‡»æ–‡æœ¬é¢œè‰² ğŸ¨ æŒ‰é’®
2. ä»é¢œè‰²é¢æ¿ä¸­é€‰æ‹©é¢œè‰²
3. é€‰ä¸­æ–‡æœ¬ååº”ç”¨æ ¼å¼

**ä»£ç ä½ç½®ï¼š**
- `script.js:7157-7165` - æ–‡æœ¬é¢œè‰²æŒ‰é’®é€»è¾‘
- `script.js:6979-7084` - é¢œè‰²é€‰æ‹©å™¨é€»è¾‘
- `script.js:2708-2710` - åº”ç”¨æ–‡æœ¬é¢œè‰²

**çŠ¶æ€å˜é‡ï¼š**
```javascript
state.lastCustomTextColor: string // æ–‡æœ¬é¢œè‰² (å¦‚ '#3b82f6')
```

---

## è¾¹æ¡†æ ·å¼ç³»ç»Ÿ

### 1. è¾¹æ¡†ç±»å‹

**æ–¹æ¡†è¾¹æ¡† (â–¡)ï¼š**
- æ ‡å‡†çŸ©å½¢è¾¹æ¡†
- æ”¯æŒè‡ªå®šä¹‰è¾¹æ¡†é¢œè‰²
- åŠ¨æ€è¾¹æ¡†å®½åº¦

**åœ†è§’è¾¹æ¡† (â—‹)ï¼š**
- åœ†è§’çŸ©å½¢è¾¹æ¡†
- 8px åœ†è§’åŠå¾„
- æ”¯æŒè‡ªå®šä¹‰è¾¹æ¡†é¢œè‰²
- åŠ¨æ€è¾¹æ¡†å®½åº¦

**ä»£ç ä½ç½®ï¼š**
- `script.js:7167-7184` - è¾¹æ¡†åˆ‡æ¢é€»è¾‘
- `styles.css:2520-2537` - è¾¹æ¡† CSS æ ·å¼

---

### 2. åŠ¨æ€è¾¹æ¡†å°ºå¯¸

**åŠŸèƒ½æè¿°ï¼š**
æ ¹æ®æ ‡æ³¨æ–‡æœ¬é•¿åº¦è‡ªåŠ¨è°ƒæ•´è¾¹æ¡†å®½åº¦å’Œå†…è¾¹è·ï¼Œé˜²æ­¢è§†è§‰æ··ä¹±ã€‚

**å°ºå¯¸è§„åˆ™ï¼š**

| æ–‡æœ¬é•¿åº¦ | è¾¹æ¡†å®½åº¦ | å‚ç›´å†…è¾¹è· | æ°´å¹³å†…è¾¹è·ï¼ˆæ–¹æ¡†ï¼‰ | æ°´å¹³å†…è¾¹è·ï¼ˆåœ†è§’ï¼‰ |
|---------|---------|-----------|------------------|------------------|
| 1-5å­—ç¬¦  | 1px     | 2px       | 3px              | 4px              |
| 6-15å­—ç¬¦ | 1.5px   | 3px       | 4px              | 5px              |
| 16-30å­—ç¬¦| 2px     | 3px       | 5px              | 6px              |
| 31+å­—ç¬¦  | 2.5px   | 4px       | 6px              | 7px              |

**ä»£ç å®ç°ï¼š**
```javascript
// script.js:2481-2530
const textLength = record.text.length;
let borderWidth, paddingY, paddingX;

if (textLength <= 5) {
    borderWidth = '1px';
    paddingY = 2;
    paddingX = record.borderStyle === 'round' ? 4 : 3;
} else if (textLength <= 15) {
    borderWidth = '1.5px';
    paddingY = 3;
    paddingX = record.borderStyle === 'round' ? 5 : 4;
} else if (textLength <= 30) {
    borderWidth = '2px';
    paddingY = 3;
    paddingX = record.borderStyle === 'round' ? 6 : 5;
} else {
    borderWidth = '2.5px';
    paddingY = 4;
    paddingX = record.borderStyle === 'round' ? 7 : 6;
}
```

---

### 3. åµŒå¥—è¾¹æ¡†å¤„ç†

**åŠŸèƒ½æè¿°ï¼š**
å½“å¤šä¸ªæ ‡æ³¨é‡å æ—¶ï¼Œè‡ªåŠ¨å¢åŠ å†…å±‚æ ‡æ³¨çš„å†…è¾¹è·ï¼Œé˜²æ­¢è¾¹æ¡†é‡å ã€‚

**å¤„ç†è§„åˆ™ï¼š**
- æ¯å¢åŠ ä¸€å±‚åµŒå¥—ï¼š
  - å‚ç›´å†…è¾¹è· +3px
  - æ°´å¹³å†…è¾¹è· +2px

**ä»£ç å®ç°ï¼š**
```javascript
// script.js:2520-2524
const nestLevel = getNestingLevel(highlight);
if (nestLevel > 0) {
    paddingY += nestLevel * 3;
    paddingX += nestLevel * 2;
}
```

**åµŒå¥—å±‚çº§æ£€æµ‹ï¼š**
```javascript
// script.js:2449-2464
function getNestingLevel(element) {
    let level = 0;
    let parent = element.parentElement;
    while (parent && parent !== dom.readingContent) {
        if (parent.classList.contains('highlight')) {
            level++;
        }
        parent = parent.parentElement;
    }
    return level;
}
```

**CSS å˜é‡åº”ç”¨ï¼š**
```css
/* styles.css:2520-2537 */
.highlight[data-border="square"] {
    border: var(--border-width, 2px) solid currentColor;
    padding: var(--border-padding-y, 3px) var(--border-padding-x, 5px);
    border-radius: 0;
}

.highlight[data-border="round"] {
    border: var(--border-width, 2px) solid currentColor;
    padding: var(--border-padding-y, 3px) var(--border-padding-x, 6px);
    border-radius: 8px;
}
```

---

## é¢œè‰²ç³»ç»Ÿ

### 1. é¢„è®¾é¢œè‰²æ¿

**é¢œè‰²æ„æˆï¼š**
- 7ç§åŸºç¡€é¢œè‰²ï¼šçº¢ã€æ©™ã€é»„ã€ç»¿ã€è“ã€ç´«ã€ç°
- æ¯ç§é¢œè‰²3ä¸ªè‰²è°ƒï¼šæµ…è‰²(Light)ã€ä¸­ç­‰(Medium)ã€æ·±è‰²(Dark)
- æ€»è®¡ï¼š7 Ã— 3 = 21ç§é¢œè‰²

**é¢œè‰²å®šä¹‰ï¼š**
```javascript
// script.js:6878-6915
const PRESET_COLORS = {
    red: {
        light: '#fca5a5',
        medium: '#ef4444',
        dark: '#991b1b'
    },
    orange: {
        light: '#fdba74',
        medium: '#f97316',
        dark: '#9a3412'
    },
    yellow: {
        light: '#fde047',
        medium: '#eab308',
        dark: '#854d0e'
    },
    green: {
        light: '#86efac',
        medium: '#22c55e',
        dark: '#166534'
    },
    blue: {
        light: '#93c5fd',
        medium: '#3b82f6',
        dark: '#1e3a8a'
    },
    purple: {
        light: '#c4b5fd',
        medium: '#8b5cf6',
        dark: '#5b21b6'
    },
    gray: {
        light: '#d1d5db',
        medium: '#6b7280',
        dark: '#1f2937'
    }
};
```

---

### 2. é¢œè‰²åº”ç”¨èŒƒå›´

**æ”¯æŒè‡ªå®šä¹‰é¢œè‰²çš„å…ƒç´ ï¼š**
1. **æ–‡æœ¬é¢œè‰²** - æ ‡æ³¨æ–‡æœ¬çš„é¢œè‰²
2. **ç²—ä½“é¢œè‰²** - ç²—ä½“æ–‡æœ¬çš„é¢œè‰²
3. **ä¸‹åˆ’çº¿é¢œè‰²** - ä¸‹åˆ’çº¿çš„é¢œè‰²
4. **è¾¹æ¡†é¢œè‰²** - æ–¹æ¡†/åœ†è§’è¾¹æ¡†çš„é¢œè‰²

**æ¯ä¸ªå…ƒç´ ç‹¬ç«‹ç®¡ç†é¢œè‰²ï¼š**
```javascript
state.lastCustomTextColor: string  // æ–‡æœ¬é¢œè‰²
state.lastBoldColor: string        // ç²—ä½“é¢œè‰²
state.lastUnderlineColor: string   // ä¸‹åˆ’çº¿é¢œè‰²
state.lastBorderColor: string      // è¾¹æ¡†é¢œè‰²
```

---

### 3. é¢œè‰²é€‰æ‹©å™¨ç•Œé¢

**UI ç»“æ„ï¼š**
```html
<!-- reader.html:407-414 -->
<div id="colorPickerPanel" class="color-picker-panel hidden">
    <div class="color-picker-content">
        <div class="color-grid" id="colorGrid">
            <!-- 21ä¸ªé¢œè‰²é€‰é¡¹ -->
        </div>
    </div>
</div>
```

**æ ·å¼è®¾è®¡ï¼š**
```css
/* styles.css:3188-3246 */
.color-picker-panel {
    position: fixed;
    z-index: 10002;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
    padding: 12px;
}

.color-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 6px;
}

.color-option {
    width: 32px;
    height: 32px;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
}

.color-option:hover {
    transform: scale(1.1);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.color-option.selected::after {
    content: 'âœ“';
    color: #fff;
    font-weight: bold;
    font-size: 18px;
}
```

---

### 4. é¢œè‰²é€‰æ‹©é€»è¾‘

**æ‰“å¼€é¢œè‰²é€‰æ‹©å™¨ï¼š**
```javascript
// script.js:6979-7015
function showColorPicker(event, target) {
    currentColorTarget = target;
    const btn = event.target;

    // æ¸²æŸ“é¢œè‰²ç½‘æ ¼
    renderColorGrid();

    // æ˜¾ç¤ºé¢æ¿
    dom.colorPickerPanel.classList.remove('hidden');

    // æ™ºèƒ½å®šä½
    const rect = btn.getBoundingClientRect();
    let left = rect.left;
    let top = rect.bottom + 5;

    // è¾¹ç•Œæ£€æµ‹
    const panelRect = dom.colorPickerPanel.getBoundingClientRect();
    if (left + panelRect.width > window.innerWidth) {
        left = window.innerWidth - panelRect.width - 10;
    }
    if (top + panelRect.height > window.innerHeight) {
        top = rect.top - panelRect.height - 5;
    }

    dom.colorPickerPanel.style.left = `${left}px`;
    dom.colorPickerPanel.style.top = `${top}px`;
}
```

**é€‰æ‹©é¢œè‰²ï¼š**
```javascript
// script.js:7039-7065
function selectColor(color) {
    switch (currentColorTarget) {
        case 'text':
            state.lastCustomTextColor = color;
            break;
        case 'bold':
            state.lastBoldColor = color;
            dom.boldColorBtn.style.backgroundColor = color;
            break;
        case 'underline':
            state.lastUnderlineColor = color;
            dom.underlineColorBtn.style.backgroundColor = color;
            break;
        case 'border':
            state.lastBorderColor = color;
            dom.borderColorBtn.style.backgroundColor = color;
            break;
    }

    saveState();
    hideColorPicker();
}
```

**ç‚¹å‡»å¤–éƒ¨å…³é—­ï¼š**
```javascript
// script.js:7067-7084
document.addEventListener('click', (e) => {
    if (!dom.colorPickerPanel.classList.contains('hidden')) {
        if (!dom.colorPickerPanel.contains(e.target) &&
            !e.target.classList.contains('color-select-btn')) {
            hideColorPicker();
        }
    }
});
```

---

## ç±»åˆ«ç®¡ç†ç³»ç»Ÿ

### 1. é»˜è®¤ç±»åˆ«

**6ä¸ªé¢„è®¾ç±»åˆ«ï¼š**
```javascript
// script.js:64-70
customCategories: [
    { id: 'vocab', label: 'ç”Ÿè¯', applyStyle: true },
    { id: 'phrase', label: 'è¯ç»„', applyStyle: true },
    { id: 'sentence', label: 'å¥å­', applyStyle: true },
    { id: 'grammar', label: 'è¯­æ³•', applyStyle: true },
    { id: 'culture', label: 'æ–‡åŒ–', applyStyle: true },
    { id: 'important', label: 'é‡ç‚¹', applyStyle: true }
]
```

**ç±»åˆ«å±æ€§ï¼š**
- `id`: å”¯ä¸€æ ‡è¯†ç¬¦
- `label`: æ˜¾ç¤ºåç§°
- `applyStyle`: æ˜¯å¦åº”ç”¨æ ·å¼ï¼ˆå¸ƒå°”å€¼ï¼‰

---

### 2. ç±»åˆ«ç®¡ç†ç•Œé¢

**æ‰“å¼€æ–¹å¼ï¼š**
ç‚¹å‡»å·¥å…·æ çš„ âš™ï¸ æŒ‰é’®

**åŠŸèƒ½èœå•ï¼š**
```html
<!-- reader.html:417-428 -->
<div id="categoryManageModal" class="modal hidden">
    <div class="modal-content">
        <h3>ğŸ“‚ ç®¡ç†æ ‡æ³¨ç±»åˆ«</h3>
        <div id="categoryList">
            <!-- åŠ¨æ€ç”Ÿæˆç±»åˆ«åˆ—è¡¨ -->
        </div>
        <button id="addCategoryBtn">â• æ·»åŠ ç±»åˆ«</button>
        <button id="closeCategoryManageBtn">å…³é—­</button>
    </div>
</div>
```

**ç±»åˆ«é¡¹ç»“æ„ï¼š**
```html
<div class="category-item">
    <input type="text" value="ç”Ÿè¯" />
    <label>
        <input type="checkbox" checked />
        åº”ç”¨æ ·å¼
    </label>
    <button class="delete-btn">ğŸ—‘ï¸</button>
</div>
```

---

### 3. CRUD æ“ä½œ

**æ·»åŠ ç±»åˆ«ï¼š**
```javascript
// script.js:6612-6628
dom.addCategoryBtn.addEventListener('click', () => {
    const newId = `custom_${Date.now()}`;
    const newCategory = {
        id: newId,
        label: 'æ–°ç±»åˆ«',
        applyStyle: true
    };
    state.customCategories.push(newCategory);
    saveState();
    renderCategoryList();
    renderCategoryButtons();
});
```

**ç¼–è¾‘ç±»åˆ«ï¼š**
```javascript
// script.js:6564-6577
labelInput.addEventListener('change', (e) => {
    const newLabel = e.target.value.trim();
    if (newLabel) {
        category.label = newLabel;
        saveState();
        renderCategoryButtons();
    } else {
        e.target.value = category.label;
    }
});
```

**åˆ é™¤ç±»åˆ«ï¼š**
```javascript
// script.js:6583-6592
deleteBtn.addEventListener('click', () => {
    if (confirm(`ç¡®å®šåˆ é™¤ç±»åˆ«"${category.label}"å—ï¼Ÿ`)) {
        const index = state.customCategories.indexOf(category);
        if (index > -1) {
            state.customCategories.splice(index, 1);
            saveState();
            renderCategoryList();
            renderCategoryButtons();
        }
    }
});
```

**åˆ‡æ¢æ ·å¼å¼€å…³ï¼š**
```javascript
// script.js:6572-6581
applyStyleCheckbox.addEventListener('change', (e) => {
    category.applyStyle = e.target.checked;
    saveState();
    renderCategoryButtons();
});
```

---

### 4. æ ·å¼åº”ç”¨é€»è¾‘

**å½“ applyStyle = trueï¼š**
- åº”ç”¨æ‰€æœ‰é€‰ä¸­çš„æ ¼å¼æ ·å¼ï¼ˆç²—ä½“ã€ä¸‹åˆ’çº¿ã€è¾¹æ¡†ã€é¢œè‰²ç­‰ï¼‰
- ç±»åˆ«æŒ‰é’®æ­£å¸¸æ˜¾ç¤º

**å½“ applyStyle = falseï¼š**
- ä»…è®°å½•ç±»åˆ«ä¿¡æ¯ï¼Œä¸æ”¹å˜æ–‡æœ¬æ ·å¼
- ç±»åˆ«æŒ‰é’®æ˜¾ç¤ºä¸ºæ–œä½“ï¼Œé€æ˜åº¦ 0.7
- ç”¨äºçº¯åˆ†ç±»æ ‡æ³¨ï¼ˆå¦‚æ ‡è®°è¯­æ³•ç±»å‹ä½†ä¸æ”¹å˜å¤–è§‚ï¼‰

**è§†è§‰åŒºåˆ†ï¼š**
```javascript
// script.js:6669-6673
if (!cat.applyStyle) {
    btn.style.opacity = '0.7';
    btn.style.fontStyle = 'italic';
    btn.title = `${cat.label}ï¼ˆä»…åˆ†ç±»ï¼Œä¸åº”ç”¨æ ·å¼ï¼‰`;
}
```

**åº”ç”¨é€»è¾‘ï¼š**
```javascript
// script.js:3130-3142
const category = state.customCategories.find(c => c.id === currentCategory);
const shouldApplyStyle = category ? category.applyStyle : true;

if (shouldApplyStyle) {
    // åº”ç”¨æ‰€æœ‰æ ¼å¼æ ·å¼
    if (state.lastBold) record.bold = true;
    if (state.lastUnderline) record.underline = true;
    // ...æ›´å¤šæ ·å¼
} else {
    // ä»…ä¿å­˜ç±»åˆ«ï¼Œä¸åº”ç”¨æ ·å¼
    record.category = currentCategory;
}
```

---

### 5. ç±»åˆ«æŒ‰é’®åŠ¨æ€æ¸²æŸ“

**æ¸²æŸ“å‡½æ•°ï¼š**
```javascript
// script.js:6643-6680
function renderCategoryButtons() {
    dom.formatCategoryGroup.innerHTML = '';

    state.customCategories.forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'format-btn';
        btn.dataset.category = cat.id;
        btn.textContent = cat.label;

        // æ¿€æ´»çŠ¶æ€
        if (cat.id === currentCategory) {
            btn.classList.add('active');
        }

        // æ ·å¼å¼€å…³è§†è§‰æ•ˆæœ
        if (!cat.applyStyle) {
            btn.style.opacity = '0.7';
            btn.style.fontStyle = 'italic';
            btn.title = `${cat.label}ï¼ˆä»…åˆ†ç±»ï¼Œä¸åº”ç”¨æ ·å¼ï¼‰`;
        }

        dom.formatCategoryGroup.appendChild(btn);
    });

    // é‡æ–°ç»‘å®šäº‹ä»¶
    handleFormatCategorySelection();
}
```

---

## æ‚¬åœèœå•ç³»ç»Ÿ

### 1. è§¦å‘æœºåˆ¶

**é¼ æ ‡æ‚¬åœæ˜¾ç¤ºï¼š**
```javascript
// script.js:926-948
highlight.addEventListener('mouseenter', (e) => {
    // æ¸…é™¤æ—§çš„è¶…æ—¶
    clearTimeout(hoverTimeout);

    // è·å–ä½ç½®
    const rect = highlight.getBoundingClientRect();
    const x = rect.left + rect.width / 2;
    const y = rect.top;

    // æ˜¾ç¤ºèœå•
    showContextMenu(x, y, highlight);
});
```

**é¼ æ ‡ç¦»å¼€å»¶è¿Ÿå…³é—­ï¼š**
```javascript
// script.js:950-961
highlight.addEventListener('mouseleave', () => {
    hoverTimeout = setTimeout(() => {
        if (!dom.highlightContextMenu.matches(':hover')) {
            hideContextMenu();
        }
    }, 150); // 150ms å»¶è¿Ÿ
});
```

**èœå•æ‚¬åœä¿æŒæ‰“å¼€ï¼š**
```javascript
// script.js:963-973
dom.highlightContextMenu.addEventListener('mouseenter', () => {
    clearTimeout(hoverTimeout);
});

dom.highlightContextMenu.addEventListener('mouseleave', () => {
    hoverTimeout = setTimeout(() => {
        hideContextMenu();
    }, 150);
});
```

---

### 2. èœå•å®šä½

**æ™ºèƒ½å®šä½é€»è¾‘ï¼š**
```javascript
// script.js:992-1030
function showContextMenu(x, y, highlightElement) {
    currentHighlight = highlightElement;

    // è·å–æ ‡æ³¨ä½ç½®
    const highlightRect = highlightElement.getBoundingClientRect();

    // æ˜¾ç¤ºèœå•ä»¥è·å–å°ºå¯¸
    dom.highlightContextMenu.classList.remove('hidden');
    const menuRect = dom.highlightContextMenu.getBoundingClientRect();

    // é»˜è®¤å®šä½åœ¨æ ‡æ³¨ä¸Šæ–¹
    let left = x - menuRect.width / 2;
    let top = y - menuRect.height - 5;

    // å·¦ä¾§è¾¹ç•Œæ£€æµ‹
    if (left < 10) {
        left = 10;
    }

    // å³ä¾§è¾¹ç•Œæ£€æµ‹
    if (left + menuRect.width > window.innerWidth - 10) {
        left = window.innerWidth - menuRect.width - 10;
    }

    // ä¸Šæ–¹ç©ºé—´ä¸è¶³æ—¶ï¼Œæ˜¾ç¤ºåœ¨ä¸‹æ–¹
    if (top < 10) {
        top = highlightRect.bottom + 5;
    }

    // åº”ç”¨ä½ç½®
    dom.highlightContextMenu.style.left = `${left}px`;
    dom.highlightContextMenu.style.top = `${top}px`;
}
```

**å®šä½è§„åˆ™ï¼š**
1. ä¼˜å…ˆæ˜¾ç¤ºåœ¨æ ‡æ³¨ä¸Šæ–¹ï¼Œå±…ä¸­å¯¹é½
2. ä¸Šæ–¹ç©ºé—´ä¸è¶³æ—¶ï¼Œæ˜¾ç¤ºåœ¨æ ‡æ³¨ä¸‹æ–¹
3. é˜²æ­¢è¶…å‡ºå·¦å³è¾¹ç•Œï¼ˆæœ€å°è¾¹è· 10pxï¼‰
4. ä½¿ç”¨ `position: fixed` ç›¸å¯¹è§†å£å®šä½

---

### 3. èœå•åŠŸèƒ½

**å¤åˆ¶æ–‡æœ¬ï¼š**
```javascript
// script.js:1105-1118
if (action === 'copy') {
    const annotation = state.annotations.find(a => a.id === annotationId);
    if (annotation) {
        navigator.clipboard.writeText(annotation.text).then(() => {
            showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
        }).catch(err => {
            console.error('å¤åˆ¶å¤±è´¥:', err);
            showToast('å¤åˆ¶å¤±è´¥', 'error');
        });
    }
    hideContextMenu();
}
```

**ç¼–è¾‘ç¬”è®°ï¼š**
```javascript
// script.js:1121-1129
if (action === 'edit') {
    const annotation = state.annotations.find(a => a.id === annotationId);
    if (annotation) {
        showNoteEditor(currentHighlight, annotation);
    }
    hideContextMenu();
}
```

**åˆ é™¤æ ‡æ³¨ï¼š**
```javascript
// script.js:1132-1152
if (action === 'delete') {
    if (confirm('ç¡®å®šåˆ é™¤æ­¤æ ‡æ³¨å—ï¼Ÿ')) {
        const annotation = state.annotations.find(a => a.id === annotationId);
        if (annotation) {
            // ç§»é™¤é«˜äº®å…ƒç´ 
            const highlight = document.querySelector(`[data-annotation-id="${annotationId}"]`);
            if (highlight) {
                const parent = highlight.parentNode;
                while (highlight.firstChild) {
                    parent.insertBefore(highlight.firstChild, highlight);
                }
                parent.removeChild(highlight);
            }

            // ä»çŠ¶æ€ä¸­åˆ é™¤
            state.annotations = state.annotations.filter(a => a.id !== annotationId);
            saveState();
            showToast('æ ‡æ³¨å·²åˆ é™¤', 'success');
        }
    }
    hideContextMenu();
}
```

**èœå• HTML ç»“æ„ï¼š**
```html
<!-- reader.html:367-390 -->
<div id="highlightContextMenu" class="context-menu hidden">
    <button class="context-menu-item" data-action="copy" title="å¤åˆ¶æ–‡æœ¬">
        <span class="context-menu-icon">ğŸ“‹</span>
        <span class="context-menu-text">å¤åˆ¶æ–‡æœ¬</span>
    </button>
    <button class="context-menu-item" data-action="edit" title="ç¼–è¾‘ç¬”è®°">
        <span class="context-menu-icon">âœï¸</span>
        <span class="context-menu-text">ç¼–è¾‘</span>
    </button>
    <button class="context-menu-item" data-action="delete" title="åˆ é™¤æ ‡æ³¨">
        <span class="context-menu-icon">ğŸ—‘ï¸</span>
        <span class="context-menu-text">åˆ é™¤</span>
    </button>
</div>
```

---

## ç¬”è®°ç¼–è¾‘å™¨

### 1. ç¼–è¾‘å™¨å®šä½

**æ™ºèƒ½å®šä½é€»è¾‘ï¼š**
```javascript
// script.js:1187-1213
function showNoteEditor(highlight, annotation) {
    currentEditingAnnotation = annotation;

    // è®¾ç½®ç¼–è¾‘å™¨å†…å®¹
    dom.noteTextarea.value = annotation.note || '';

    // æ˜¾ç¤ºç¼–è¾‘å™¨
    dom.noteEditor.classList.remove('hidden');

    // è·å–æ ‡æ³¨ä½ç½®ï¼ˆç›¸å¯¹äºè§†å£ï¼‰
    const rect = highlight.getBoundingClientRect();

    // ä½¿ç”¨ fixed å®šä½
    dom.noteEditor.style.position = 'fixed';

    // åˆå§‹å®šä½åœ¨æ ‡æ³¨ä¸‹æ–¹
    dom.noteEditor.style.left = `${rect.left}px`;
    dom.noteEditor.style.top = `${rect.bottom + 5}px`;

    // è·å–ç¼–è¾‘å™¨å°ºå¯¸
    const editorRect = dom.noteEditor.getBoundingClientRect();

    // æ£€æŸ¥æ˜¯å¦è¶…å‡ºè§†å£åº•éƒ¨
    if (editorRect.bottom > window.innerHeight) {
        // æ˜¾ç¤ºåœ¨æ ‡æ³¨ä¸Šæ–¹
        dom.noteEditor.style.top = `${rect.top - editorRect.height - 5}px`;
    }

    // æ£€æŸ¥æ˜¯å¦è¶…å‡ºè§†å£å³ä¾§
    if (editorRect.right > window.innerWidth) {
        dom.noteEditor.style.left = `${window.innerWidth - editorRect.width - 10}px`;
    }

    dom.noteTextarea.focus();
}
```

**å®šä½è§„åˆ™ï¼š**
1. é»˜è®¤æ˜¾ç¤ºåœ¨æ ‡æ³¨ä¸‹æ–¹ï¼Œå·¦å¯¹é½
2. åº•éƒ¨ç©ºé—´ä¸è¶³æ—¶ï¼Œæ˜¾ç¤ºåœ¨æ ‡æ³¨ä¸Šæ–¹
3. å³ä¾§è¶…å‡ºæ—¶ï¼Œå³å¯¹é½è§†å£è¾¹ç•Œ
4. ä½¿ç”¨ `position: fixed` é˜²æ­¢æ»šåŠ¨é—®é¢˜

---

### 2. ç¬”è®°ä¿å­˜

**ä¿å­˜ç¬”è®°ï¼š**
```javascript
// script.js:1220-1235
dom.saveNoteBtn.addEventListener('click', () => {
    if (currentEditingAnnotation) {
        const noteText = dom.noteTextarea.value.trim();
        currentEditingAnnotation.note = noteText;

        // æ›´æ–°é«˜äº®å…ƒç´ çš„ title
        const highlight = document.querySelector(
            `[data-annotation-id="${currentEditingAnnotation.id}"]`
        );
        if (highlight) {
            highlight.title = noteText || currentEditingAnnotation.text;
        }

        saveState();
        showToast('ç¬”è®°å·²ä¿å­˜', 'success');
    }
    hideNoteEditor();
});
```

**å–æ¶ˆç¼–è¾‘ï¼š**
```javascript
// script.js:1238-1240
dom.cancelNoteBtn.addEventListener('click', () => {
    hideNoteEditor();
});
```

---

## çŠ¶æ€ç®¡ç†ä¸æŒä¹…åŒ–

### 1. çŠ¶æ€ç»“æ„

**å®Œæ•´çŠ¶æ€å¯¹è±¡ï¼š**
```javascript
// script.js:14-71
const state = {
    // æ ¼å¼çŠ¶æ€
    lastBold: false,
    lastUnderline: false,
    lastDashed: false,
    lastSlash: false,
    lastBorderStyle: 'none',

    // é¢œè‰²çŠ¶æ€
    lastCustomTextColor: null,
    lastBoldColor: null,
    lastUnderlineColor: null,
    lastBorderColor: null,

    // ç±»åˆ«çŠ¶æ€
    customCategories: [...],

    // æ ‡æ³¨æ•°æ®
    annotations: [],

    // å…¶ä»–çŠ¶æ€...
};
```

---

### 2. localStorage æŒä¹…åŒ–

**ä¿å­˜çŠ¶æ€ï¼š**
```javascript
// script.js:200-205
function saveState() {
    try {
        localStorage.setItem('readerState', JSON.stringify(state));
    } catch (error) {
        console.error('ä¿å­˜çŠ¶æ€å¤±è´¥:', error);
    }
}
```

**åŠ è½½çŠ¶æ€ï¼š**
```javascript
// script.js:208-226
function loadState() {
    try {
        const saved = localStorage.getItem('readerState');
        if (saved) {
            const parsed = JSON.parse(saved);
            Object.assign(state, parsed);

            // æ¢å¤æ ¼å¼æŒ‰é’®çŠ¶æ€
            restoreFormatButtonStates();

            // æ¢å¤é¢œè‰²æŒ‰é’®
            restoreColorButtons();

            // æ¸²æŸ“ç±»åˆ«æŒ‰é’®
            renderCategoryButtons();
        }
    } catch (error) {
        console.error('åŠ è½½çŠ¶æ€å¤±è´¥:', error);
    }
}
```

**åˆå§‹åŒ–æ—¶è‡ªåŠ¨åŠ è½½ï¼š**
```javascript
// script.js:8525
document.addEventListener('DOMContentLoaded', () => {
    initializeApp();
    loadState();
});
```

---

### 3. æ ‡æ³¨æ•°æ®ç»“æ„

**å•ä¸ªæ ‡æ³¨å¯¹è±¡ï¼š**
```javascript
const annotation = {
    id: 'ann_1696234567890',          // å”¯ä¸€ID
    text: 'example text',              // æ ‡æ³¨æ–‡æœ¬
    category: 'vocab',                 // ç±»åˆ«
    note: 'è¿™æ˜¯ä¸€ä¸ªç”Ÿè¯',              // ç¬”è®°

    // æ ·å¼å±æ€§
    bold: true,                        // ç²—ä½“
    underline: false,                  // ä¸‹åˆ’çº¿
    dashed: false,                     // è™šçº¿ä¸‹åˆ’çº¿
    slash: false,                      // æ–œæ åˆ†éš”ç¬¦
    borderStyle: 'square',             // è¾¹æ¡†æ ·å¼

    // é¢œè‰²å±æ€§
    customTextColor: '#3b82f6',        // æ–‡æœ¬é¢œè‰²
    boldColor: '#ef4444',              // ç²—ä½“é¢œè‰²
    underlineColor: '#22c55e',         // ä¸‹åˆ’çº¿é¢œè‰²
    borderColor: '#8b5cf6',            // è¾¹æ¡†é¢œè‰²

    // å…ƒæ•°æ®
    timestamp: 1696234567890,          // åˆ›å»ºæ—¶é—´
    startOffset: 0,                    // èµ·å§‹ä½ç½®
    endOffset: 12                      // ç»“æŸä½ç½®
};
```

---

## äº¤äº’åé¦ˆç³»ç»Ÿ

### 1. Toast é€šçŸ¥

**æ˜¾ç¤ºé€šçŸ¥ï¼š**
```javascript
// script.js:6358-6387
function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.textContent = message;

    // æ·»åŠ åˆ°é¡µé¢
    document.body.appendChild(toast);

    // è§¦å‘åŠ¨ç”»
    setTimeout(() => {
        toast.classList.add('show');
    }, 10);

    // è‡ªåŠ¨ç§»é™¤
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
            document.body.removeChild(toast);
        }, 300);
    }, 3000);
}
```

**é€šçŸ¥ç±»å‹ï¼š**
- `success` - ç»¿è‰²ï¼ŒæˆåŠŸæ“ä½œ
- `error` - çº¢è‰²ï¼Œé”™è¯¯æç¤º
- `warning` - æ©™è‰²ï¼Œè­¦å‘Šä¿¡æ¯
- `info` - è“è‰²ï¼Œæ™®é€šä¿¡æ¯

**æ ·å¼è®¾è®¡ï¼š**
```css
/* styles.css:2895-2945 */
.toast {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 12px 24px;
    border-radius: 8px;
    color: #fff;
    font-size: 14px;
    z-index: 10000;
    opacity: 0;
    transform: translateY(-20px);
    transition: all 0.3s ease;
}

.toast.show {
    opacity: 1;
    transform: translateY(0);
}

.toast-success { background: #22c55e; }
.toast-error { background: #ef4444; }
.toast-warning { background: #f97316; }
.toast-info { background: #3b82f6; }
```

---

### 2. è§†è§‰åé¦ˆ

**æŒ‰é’®æ¿€æ´»çŠ¶æ€ï¼š**
```css
/* styles.css:1245-1250 */
.format-btn.active {
    background-color: #3b82f6;
    color: white;
    border-color: #2563eb;
}
```

**é¢œè‰²æŒ‰é’®æ˜¾ç¤ºï¼š**
```javascript
// script.js:7115-7123
dom.formatBoldToggle.addEventListener('click', () => {
    state.lastBold = !state.lastBold;
    dom.formatBoldToggle.classList.toggle('active', state.lastBold);

    // æ˜¾ç¤º/éšè—é¢œè‰²æŒ‰é’®
    dom.boldColorBtn.classList.toggle('hidden', !state.lastBold);

    saveState();
});
```

**æ‚¬åœæ•ˆæœï¼š**
```css
/* styles.css:1238-1243 */
.format-btn:hover {
    background-color: #f3f4f6;
    border-color: #d1d5db;
}

.color-option:hover {
    transform: scale(1.1);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}
```

---

## ä½¿ç”¨æµç¨‹

### æ ‡å‡†æ ‡æ³¨æµç¨‹

**æ­¥éª¤ 1ï¼šé€‰æ‹©æ–‡æœ¬**
- åœ¨é˜…è¯»åŒºåŸŸé€‰ä¸­è¦æ ‡æ³¨çš„æ–‡æœ¬
- æˆ–åŒå‡»å•ä¸ªå•è¯å¿«é€Ÿé€‰ä¸­

**æ­¥éª¤ 2ï¼šè®¾ç½®æ ¼å¼ï¼ˆå¯é€‰ï¼‰**
- ç‚¹å‡»å·¥å…·æ æŒ‰é’®è®¾ç½®æ ·å¼ï¼š
  - **B** - ç²—ä½“
  - **U** - ä¸‹åˆ’çº¿
  - **- -** - è™šçº¿ä¸‹åˆ’çº¿
  - **/ /** - æ–œæ åˆ†éš”ç¬¦
  - **â–¡** / **â—‹** - è¾¹æ¡†
- ç‚¹å‡» ğŸ¨ æŒ‰é’®é€‰æ‹©é¢œè‰²

**æ­¥éª¤ 3ï¼šé€‰æ‹©ç±»åˆ«**
- ç‚¹å‡»ç±»åˆ«æŒ‰é’®ï¼ˆç”Ÿè¯ã€è¯ç»„ã€å¥å­ç­‰ï¼‰
- æˆ–ä½¿ç”¨è‡ªå®šä¹‰ç±»åˆ«

**æ­¥éª¤ 4ï¼šåº”ç”¨æ ‡æ³¨**
- è‡ªåŠ¨åº”ç”¨é€‰ä¸­çš„æ ¼å¼å’Œç±»åˆ«
- æ ‡æ³¨ç«‹å³æ˜¾ç¤ºåœ¨æ–‡æœ¬ä¸Š

**æ­¥éª¤ 5ï¼šæ·»åŠ ç¬”è®°ï¼ˆå¯é€‰ï¼‰**
- æ‚¬åœåœ¨æ ‡æ³¨ä¸Šï¼Œç‚¹å‡»ç¼–è¾‘æŒ‰é’®
- åœ¨å¼¹å‡ºçš„ç¼–è¾‘å™¨ä¸­è¾“å…¥ç¬”è®°
- ç‚¹å‡»ä¿å­˜

---

### å¿«æ·æ“ä½œ

**å¤åˆ¶æ ‡æ³¨æ–‡æœ¬ï¼š**
1. æ‚¬åœåœ¨æ ‡æ³¨ä¸Š
2. ç‚¹å‡»èœå•ä¸­çš„ ğŸ“‹ å¤åˆ¶æŒ‰é’®
3. æ–‡æœ¬å·²å¤åˆ¶åˆ°å‰ªè´´æ¿

**ç¼–è¾‘æ ‡æ³¨ï¼š**
1. æ‚¬åœåœ¨æ ‡æ³¨ä¸Š
2. ç‚¹å‡»èœå•ä¸­çš„ âœï¸ ç¼–è¾‘æŒ‰é’®
3. ä¿®æ”¹ç¬”è®°åä¿å­˜

**åˆ é™¤æ ‡æ³¨ï¼š**
1. æ‚¬åœåœ¨æ ‡æ³¨ä¸Š
2. ç‚¹å‡»èœå•ä¸­çš„ ğŸ—‘ï¸ åˆ é™¤æŒ‰é’®
3. ç¡®è®¤åˆ é™¤

---

### é«˜çº§åŠŸèƒ½

**è‡ªå®šä¹‰ç±»åˆ«ï¼š**
1. ç‚¹å‡»å·¥å…·æ çš„ âš™ï¸ æŒ‰é’®
2. åœ¨å¼¹å‡ºçš„ç®¡ç†é¢æ¿ä¸­ï¼š
   - ç‚¹å‡» â• æ·»åŠ æ–°ç±»åˆ«
   - ä¿®æ”¹ç°æœ‰ç±»åˆ«åç§°
   - åˆ‡æ¢"åº”ç”¨æ ·å¼"å¼€å…³
   - åˆ é™¤ä¸éœ€è¦çš„ç±»åˆ«
3. ç‚¹å‡»å…³é—­ä¿å­˜æ›´æ”¹

**çº¯åˆ†ç±»æ ‡æ³¨ï¼ˆæ— æ ·å¼ï¼‰ï¼š**
1. æ‰“å¼€ç±»åˆ«ç®¡ç†
2. å–æ¶ˆ"åº”ç”¨æ ·å¼"å¤é€‰æ¡†
3. è¯¥ç±»åˆ«å°†åªè®°å½•åˆ†ç±»ï¼Œä¸æ”¹å˜æ–‡æœ¬å¤–è§‚
4. ç±»åˆ«æŒ‰é’®æ˜¾ç¤ºä¸ºæ–œä½“ï¼Œé€æ˜åº¦é™ä½

**å¤šå±‚åµŒå¥—æ ‡æ³¨ï¼š**
1. æ ‡æ³¨ä¸€æ®µæ–‡æœ¬
2. åœ¨å·²æ ‡æ³¨çš„æ–‡æœ¬ä¸­é€‰æ‹©éƒ¨åˆ†å†…å®¹
3. åº”ç”¨ä¸åŒçš„æ ‡æ³¨
4. ç³»ç»Ÿè‡ªåŠ¨è°ƒæ•´è¾¹æ¡†å¤§å°é˜²æ­¢é‡å 

---

## æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. æ ¸å¿ƒæŠ€æœ¯æ ˆ

**å‰ç«¯æ¡†æ¶ï¼š** åŸç”Ÿ JavaScript (ES6+)
**æ ·å¼ï¼š** CSS3ï¼ˆGridã€Flexboxã€CSS Variablesï¼‰
**å­˜å‚¨ï¼š** localStorage
**APIï¼š** Clipboard API

---

### 2. å…³é”®ç®—æ³•

**Range é«˜äº®ç®—æ³•ï¼š**
```javascript
// script.js:2575-2650
function applyHighlight(range, record) {
    const highlight = document.createElement('span');
    highlight.className = 'highlight';
    highlight.dataset.annotationId = record.id;

    // åº”ç”¨æ ·å¼
    if (record.bold) highlight.style.fontWeight = 'bold';
    if (record.underline) highlight.style.textDecoration = 'underline';
    // ...

    // åŒ…è£¹é€‰ä¸­å†…å®¹
    try {
        range.surroundContents(highlight);
    } catch (error) {
        // å¤„ç†è·¨èŠ‚ç‚¹é€‰æ‹©
        const fragment = range.extractContents();
        highlight.appendChild(fragment);
        range.insertNode(highlight);
    }
}
```

**åµŒå¥—å±‚çº§è®¡ç®—ï¼š**
```javascript
// script.js:2449-2464
function getNestingLevel(element) {
    let level = 0;
    let parent = element.parentElement;
    while (parent && parent !== dom.readingContent) {
        if (parent.classList.contains('highlight')) {
            level++;
        }
        parent = parent.parentElement;
    }
    return level;
}
```

---

### 3. æ€§èƒ½ä¼˜åŒ–

**äº‹ä»¶å§”æ‰˜ï¼š**
```javascript
// ä½¿ç”¨äº‹ä»¶å§”æ‰˜å¤„ç†ç±»åˆ«æŒ‰é’®ç‚¹å‡»
dom.formatCategoryGroup.addEventListener('click', (e) => {
    if (e.target.classList.contains('format-btn')) {
        const categoryId = e.target.dataset.category;
        handleCategorySelection(categoryId);
    }
});
```

**é˜²æŠ–å»¶è¿Ÿï¼š**
```javascript
// 150ms å»¶è¿Ÿé˜²æ­¢èœå•é¢‘ç¹å¼€å…³
let hoverTimeout;
hoverTimeout = setTimeout(() => {
    if (!dom.highlightContextMenu.matches(':hover')) {
        hideContextMenu();
    }
}, 150);
```

**æ¡ä»¶æ¸²æŸ“ï¼š**
```javascript
// ä»…åœ¨éœ€è¦æ—¶æ˜¾ç¤ºé¢œè‰²æŒ‰é’®
dom.boldColorBtn.classList.toggle('hidden', !state.lastBold);
```

---

### 4. æµè§ˆå™¨å…¼å®¹æ€§

**æ”¯æŒçš„æµè§ˆå™¨ï¼š**
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

**ä½¿ç”¨çš„ç°ä»£ APIï¼š**
- `Navigator.clipboard.writeText()` - å‰ªè´´æ¿ API
- `element.getBoundingClientRect()` - å…ƒç´ å®šä½
- `CSS Grid` - é¢œè‰²é¢æ¿å¸ƒå±€
- `CSS Custom Properties` - åŠ¨æ€æ ·å¼
- `localStorage` - æ•°æ®æŒä¹…åŒ–

---

### 5. æ–‡ä»¶ç»“æ„

```
public/
â”œâ”€â”€ reader.html          # ä¸» HTML æ–‡ä»¶ (48,638 å­—èŠ‚)
â”œâ”€â”€ script.js            # ä¸» JavaScript æ–‡ä»¶ (249,197 å­—èŠ‚)
â”œâ”€â”€ styles.css           # ä¸»æ ·å¼æ–‡ä»¶ (72,567 å­—èŠ‚)
â””â”€â”€ TOOLBAR_FEATURES_GUIDE.md  # æœ¬æ–‡æ¡£
```

**ä»£ç è¡Œæ•°ç»Ÿè®¡ï¼š**
- `reader.html`: ~1200 è¡Œ
- `script.js`: ~8500 è¡Œ
- `styles.css`: ~3300 è¡Œ

---

## é™„å½•

### A. å¿«æ·é”®ï¼ˆæœªæ¥å¯æ‰©å±•ï¼‰

ç›®å‰æœªå®ç°å¿«æ·é”®ï¼Œå»ºè®®æœªæ¥æ·»åŠ ï¼š
- `Ctrl + B` - åˆ‡æ¢ç²—ä½“
- `Ctrl + U` - åˆ‡æ¢ä¸‹åˆ’çº¿
- `Ctrl + C`ï¼ˆåœ¨æ ‡æ³¨ä¸Šï¼‰- å¤åˆ¶æ ‡æ³¨æ–‡æœ¬
- `Delete`ï¼ˆåœ¨æ ‡æ³¨ä¸Šï¼‰- åˆ é™¤æ ‡æ³¨
- `Ctrl + E` - ç¼–è¾‘ç¬”è®°

---

### B. å¸¸è§é—®é¢˜

**Q: å¦‚ä½•åˆ é™¤æ‰€æœ‰æ ‡æ³¨ï¼Ÿ**
A: ç›®å‰éœ€è¦é€ä¸ªåˆ é™¤ã€‚å»ºè®®æ·»åŠ "æ¸…é™¤æ‰€æœ‰æ ‡æ³¨"åŠŸèƒ½ã€‚

**Q: æ ‡æ³¨æ•°æ®å¦‚ä½•å¯¼å‡ºï¼Ÿ**
A: æ•°æ®å­˜å‚¨åœ¨ localStorage ä¸­ï¼Œå¯ä»¥é€šè¿‡å¯¼å‡ºåŠŸèƒ½ä¿å­˜ä¸º JSON æ–‡ä»¶ï¼ˆéœ€å®ç°ï¼‰ã€‚

**Q: æ”¯æŒå¤šäººåä½œå—ï¼Ÿ**
A: ç›®å‰ä»…æ”¯æŒæœ¬åœ°å•äººä½¿ç”¨ã€‚å¤šäººåä½œéœ€è¦åç«¯æœåŠ¡å™¨æ”¯æŒã€‚

**Q: èƒ½å¦åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šä½¿ç”¨ï¼Ÿ**
A: å½“å‰ä¸»è¦ä¸ºæ¡Œé¢è®¾è®¡ï¼Œç§»åŠ¨ç«¯ä½“éªŒéœ€ä¼˜åŒ–ã€‚

---

### C. å¼€å‘è·¯çº¿å›¾

**çŸ­æœŸè®¡åˆ’ï¼š**
- [ ] å¿«æ·é”®æ”¯æŒ
- [ ] æ ‡æ³¨æœç´¢åŠŸèƒ½
- [ ] å¯¼å‡º/å¯¼å…¥åŠŸèƒ½
- [ ] ç§»åŠ¨ç«¯é€‚é…

**é•¿æœŸè®¡åˆ’ï¼š**
- [ ] äº‘ç«¯åŒæ­¥
- [ ] å¤šäººåä½œ
- [ ] AI è¾…åŠ©æ ‡æ³¨
- [ ] è¯­éŸ³ç¬”è®°

---

## æ›´æ–°æ—¥å¿—

**v1.0.0 (2025-10-03)**
- âœ¨ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ¨ å®Œæ•´å·¥å…·æ åŠŸèƒ½
- âœ¨ 21è‰²é¢œè‰²ç³»ç»Ÿ
- âœ¨ ç±»åˆ«ç®¡ç†ç³»ç»Ÿ
- âœ¨ æ‚¬åœèœå•
- âœ¨ åŠ¨æ€è¾¹æ¡†
- âœ¨ Toast é€šçŸ¥

---

## è´¡çŒ®è€…

æœ¬æ–‡æ¡£ç”± Claude Code è‡ªåŠ¨ç”Ÿæˆ
ç”Ÿæˆæ—¶é—´ï¼š2025-10-03

---

**æ–‡æ¡£ç»“æŸ**
