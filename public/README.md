# 英语短文阅读标注工具 - 完整功能指南

## 🎉 新功能总览

### ✅ 1. 笔记悬浮提示
**功能描述**：当标注包含笔记时，鼠标悬停在标注文本上会自动显示笔记内容。

**使用方法**：
- 标注文本时添加释义/注释
- 鼠标悬停在标注上
- 自动显示深色提示框

**特点**：
- 优雅的深色UI设计
- 自动定位在标注上方
- 最大宽度300px，自动换行

---

### ✅ 2. Markdown格式导入
**功能描述**：支持导入Markdown文件并自动转换为纯文本。

**使用方法**：
1. 点击"导入 Markdown"按钮（在"保存并打开短文"旁边）
2. 选择.md或.markdown文件
3. 系统自动解析并填充到输入框

**支持的Markdown语法**：
- 标题（#）
- 粗体/斜体（**text** 或 *text*）
- 链接（[text](url)）
- 代码块（```code```）
- 列表（- item 或 1. item）
- 引用（> quote）

---

### ✅ 3. 数字选项识别
**功能描述**：自动识别并美化选择题选项（A/B/C/D或1/2/3/4）。

**使用方法**：
直接粘贴包含选项的文本，系统自动识别并美化。

**支持的选项格式**：
- `A. 选项内容`
- `A) 选项内容`
- `(A) 选项内容`
- `1. 选项内容`
- `1) 选项内容`
- `(1) 选项内容`

**显示效果**：
- 选项标记蓝色高亮
- 左侧蓝色边框
- 悬停时背景高亮

**示例**：
```
What is the capital of France?
A. London
B. Paris
C. Berlin
D. Madrid
```

---

### ✅ 4. 单独划线模式
**功能描述**：只使用下划线标注，不显示背景色。

**使用方法**：
1. 选择文本
2. 在标注工具栏勾选"仅划线(无背景)"
3. 保存标注

**特点**：
- 更简洁的视觉效果
- 适合不喜欢高亮背景的用户
- 2px实线下划线

---

### ✅ 5. 字体颜色和大小控制
**功能描述**：独立控制标注文本的颜色和大小。

**文本颜色选项**：
- 默认（使用类别默认颜色）
- 红色
- 蓝色
- 绿色
- 紫色
- 橙色

**字体大小选项**：
- 小（0.9em）
- 中（1em，默认）
- 大（1.1em）
- 特大（1.2em）

**使用方法**：
1. 选择文本打开标注工具栏
2. 在"文本颜色"下拉菜单选择颜色
3. 在"字体大小"下拉菜单选择大小
4. 保存标注

---

### ✅ 6. 快速标注优化
**功能描述**：点击"快速标注"后直接应用预设样式，无需弹窗。

**使用方法**：
1. 在格式工具栏设置：
   - 颜色（蜜糖/薄荷/天空/兰花/落日）
   - 加粗
   - 下划线
2. 选择文本
3. 点击"快速标注"按钮
4. 直接应用样式，无弹窗

**格式工具栏位置**：
在"阅读标注区"顶部，包含：
- 加粗按钮（B）
- 下划线按钮（U）
- 5种颜色按钮
- 快速标注按钮

---

## 🛠️ 手动修复步骤

由于HTML文件存在编码问题，需要手动修复第155-174行的内容：

### 步骤1：打开index.html
使用支持UTF-8编码的编辑器（如VS Code、Notepad++等）

### 步骤2：定位到第155行
找到包含乱码的`<fieldset>`部分

### 步骤3：替换内容
将这部分完整替换为UPDATES.md文件中提供的"修复后"版本

### 步骤4：保存
确保使用UTF-8编码保存文件

---

## 📖 完整使用流程

### 1. 导入文本
**方式一：直接粘贴**
- 在"短文输入"区域粘贴文本
- 点击"保存并打开短文"

**方式二：Markdown导入**
- 点击"导入 Markdown"
- 选择.md文件
- 点击"保存并打开短文"

### 2. 阅读与标注
**普通标注**（完整控制）：
1. 在阅读区选择文本
2. 工具栏自动弹出
3. 选择类型（生词/词组/疑难/重点/翻译/自定义）
4. 选择颜色
5. 选择样式（加粗/下划线/仅划线）
6. 选择文本颜色和字体大小
7. 添加释义/注释
8. 添加标签
9. 点击"保存标注"

**快速标注**（预设样式）：
1. 在格式工具栏设置样式
2. 选择文本
3. 点击"快速标注"

### 3. 查看笔记
- 鼠标悬停在标注上
- 自动显示笔记内容（如果有）

### 4. 管理标注
- 在"知识提取"面板查看所有标注
- 按类别筛选
- 按标签筛选
- 定位/编辑/删除标注

### 5. 导出与备份
- **复制全部**：复制为文本格式
- **导出 JSON**：导出当前筛选的标注
- **备份全部数据**：备份所有短文和标注
- **导入 JSON**：导入标注数据

---

## 🎨 样式示例

### 高亮+加粗+笔记
```
选中"resilience"
- 类别：生词
- 颜色：蜜糖色
- 加粗：✓
- 文本颜色：红色
- 字体大小：大
- 笔记：n. 韧性，恢复力
```
**效果**：黄色背景，红色加粗文字，较大字号，悬停显示释义

### 仅划线
```
选中"critical thinking"
- 类别：词组
- 仅划线：✓
- 文本颜色：蓝色
- 笔记：批判性思维
```
**效果**：蓝色下划线，无背景，悬停显示释义

### 选择题自动识别
```
输入文本：
Which one is correct?
A. Option one
B. Option two
C. Option three
D. Option four
```
**效果**：
- A/B/C/D蓝色标记
- 每个选项左侧蓝色边框
- 悬停时背景高亮

---

## 💾 数据持久化

所有数据自动保存到浏览器localStorage，包括：
- 短文内容
- 所有标注（文本、类别、颜色、样式、笔记、标签）
- 新增字段：underlineOnly、textColor、fontSize
- 用户偏好设置

**数据兼容性**：
- 旧数据自动升级
- 新字段使用默认值
- 不会丢失任何数据

---

## 🔧 技术实现

### CSS更新
- 添加`.highlight-tooltip`样式
- 添加字体大小类（`data-font-size`）
- 添加文本颜色类（`data-text-color`）
- 添加纯划线模式（`data-underline-only`）
- 添加选项标识样式（`.option-marker`, `.option-line`）

### JavaScript更新
- 新增state字段：`lastUnderlineOnly`、`lastTextColor`、`lastFontSize`
- 新增函数：
  - `createTooltip()` - 创建提示框
  - `handleHighlightHover()` - 处理悬停
  - `handleHighlightLeave()` - 处理离开
  - `handleMarkdownImport()` - Markdown导入
  - `parseMarkdownToPlainText()` - Markdown解析
  - `highlightOptions()` - 选项识别
- 更新数据模型以包含新字段
- 更新持久化逻辑

---

## 🐛 已知问题与解决方案

### 问题1：HTML乱码
**原因**：编码问题
**解决**：参考UPDATES.md手动修复

### 问题2：快速标注无响应
**原因**：DOM元素未找到
**检查**：确保HTML中有所有必需的控件

### 问题3：选项识别失败
**原因**：格式不匹配
**解决**：确保选项格式为`A. 内容`或`1. 内容`等标准格式

---

## 📚 常见问题

**Q: 如何批量修改标注样式？**
A: 目前需要逐个编辑。建议使用快速标注功能提前设置好样式。

**Q: 是否支持跨段落标注？**
A: 不支持。请在单个段落内进行标注。

**Q: 数据存在哪里？**
A: localStorage（浏览器本地存储）。建议定期使用"备份全部数据"功能。

**Q: 如何迁移数据到其他浏览器？**
A: 使用"备份全部数据"导出，在新浏览器中使用"恢复全部数据"导入。

**Q: Markdown导入会保留格式吗？**
A: 不会，会转换为纯文本。保留语义内容，去除格式标记。

---

## 🚀 后续改进方向

- [ ] 批量标注样式修改
- [ ] 标注模板功能
- [ ] 跨段落标注支持
- [ ] 导出为PDF/Word
- [ ] 云端同步
- [ ] 语音朗读集成
- [ ] AI翻译集成

---

**版本**：2.0
**更新日期**：2025-10-02
**作者**：Claude Code

享受更强大的英语学习体验！🎓
